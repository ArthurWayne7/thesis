\chapter{基于空间邻接感知的模块化建筑平面布局优化研究}
\label{chap:layout_optimization}

\section{引言}
\label{sec:layout_intro}

\subsection{研究背景：模块化建筑平面设计的范式转变}

模块化建筑（Modular Construction）作为建筑工业化的高级形态，凭借其在提
升施工效率、优化质量控制以及降低环境足迹方面的显著优势，近年来在全球范围内得
到了广泛关注与应用 \citep{Lawson2014, zhai2019internet}。与传统的现场浇
筑模式不同，模块化建筑将大部分建造工序前置于受控的工厂环境中完成，这种制造模
式的革新对上游的设计流程提出了全新的约束与挑战 \citep{thai2020review}。

在传统建筑设计中，设计师通常遵循“形式追随功能”的原则，优先考虑空间的功
能组织、流线效率及形态美学。然而，在模块化建筑的语境下，设计逻辑发生了根本性
的转变，要求“功能适应模数”。这意味着建筑平面不仅要满足使用功能，还必须能
够被精确地离散化（Discretized）为一系列符合运输、吊装及制造限制的标准化体
积单元（Volumetric Units）。

这种从连续的自由形态平面到离散的模块化组合的转换过程，即“平面
模块化”（Floor Plan Modularization），本质上是一个复杂的几何分
割与组合优化问题。如图 \ref{fig:conceptual_framework} 所示，该过程旨
在将任意给定的建筑平面轮廓自动转化为由标准化模块组成的网格布局。一个高质量
的模块化布局方案不仅需要最大化地覆盖原始轮廓以保障得房率，更需要严格遵守模
块的尺寸约束，并维持房间内部的空间完整性（Spatial Integrity）与房间之间
的功能邻接关系（Spatial Adjacency）。


\begin{figure}[H]
\centering
\includegraphics[width=1\textwidth,height=0.4\textheight, keepaspectratio]{Fig2/test1.png}
\caption{本文提出的空间邻接感知模块化过程的概念框架示意图。}
\label{fig:conceptual_framework}
\end{figure}

\subsection{现有方法的局限性}

尽管计算机辅助设计（CAD）和建筑信息模型（BIM）技术已广泛普及，但目前
的模块化平面设计仍主要依赖人工经验或半自动化的规则算法，效率低下且难以保
证解的质量。现有的自动化布局方法主要存在以下局限性：

\begin{enumerate}
    \item \textbf{缺乏对空间拓扑关系的考量：} 传统的几何分割算
	法（如矩形剖分、网格平铺）通常将平面视为纯粹的几何图形进
	行切割 \citep{Wu2019}。这种“几何优先”的策略往往忽视了建筑功
	能的内在逻辑，容易切断房间之间的必要连接（例如将一个完整的起居室
	分割为互不连通的两个模块），或者产生大量无法使用的狭长碎片空间，导致
	生成的布局在建筑功能上不可行。
    
    \item \textbf{标准化程度与灵活性的矛盾：} 现有的启发式优化
	算法（如遗传算法、模拟退火）在处理规则矩形轮廓时表现尚可，但
	在面对现实中常见的非凸、不规则建筑边界时，往往难以在“模块标准
	化”（减少模块类型以降低成本）和“轮廓匹配度”（提高覆盖率）之间
	找到最佳平衡点，容易陷入局部最优解 \citep{Li2020_opt}。
    
    \item \textbf{计算效率瓶颈：} 许多基于搜索的生成方法随着平面复
	杂度的增加，计算时间呈指数级增长，难以满足早期设计阶段快速迭代、
	实时反馈的需求。
\end{enumerate}

\subsection{本章研究目标与主要贡献}

针对上述挑战，本章提出了一种基于深度强化学习（Deep Reinforc
ement Learning, DRL）的端到端模块化布局生成框架。该框架不依赖于
预定义的分割模板，而是通过学习“如何组装”的策略，从底层的原子网格出
发，逐步构建出最优的模块化布局。

本章的主要研究贡献总结如下：

\begin{itemize}
    \item \textbf{提出基于空间邻接感知的状
	态表示（Adjacency-Aware State Representation）：} 创新性地构建了
	包含几何特征与拓扑关系的多模态状态空间。通过引入邻接
	图（Adjacency Graph）作为状态的一部分，智能体在决
	策过程中能够显式地感知当前网格与周边区域的连通性，从而有
	效防止功能空间的割裂。

    \item \textbf{设计基于“合并”策略的动作空
	间（Merge-based Action Space）：} 不同于传统的“自顶向下”
	分割策略，本研究采用“自底向上”的合并机制。智能体从细粒度的正交
	网格开始，通过学习最优的合并动作序列，将相邻网格聚合成符合尺寸
	约束的标准化大模块。这种机制天然地保证了模块的几何规整性。
    
    \item \textbf{构建多目标奖励函数体
	系（Multi-objective Reward Function）：} 综合考虑
	了覆盖率（Coverage）、模块数量（Module Count）、类型
	标准化（Standardization）以及边界平滑度（Boundary Smoothness）等多个
	优化目标。通过精心设计的奖励信号，引导智能体在复杂的约束空间中
	搜索出兼顾制造效率与建筑性能的全局最优解。
\end{itemize}

通过本章提出的方法，我们致力于解决“标准化制造”与“多样化设计”之间
的矛盾，为模块化建筑的智能设计提供一种新的技术路径。

\section{模块化布局生成的问题定义与建模}
\label{sec:problem_formulation}

在深入探讨具体的算法实现之前，本节首先对模块化平面布局生成问题进行严
格的数学定义。我们将该问题建模为一个受多重几何与拓扑约束限制的组合优化
问题（Combinatorial Optimization Problem），旨在寻找一组最优的模块
配置，使其在满足制造与功能要求的同时，最大化地匹配给定的建筑轮廓。

\subsection{符号定义与输入输出}

给定一个任意形状的建筑平面轮廓 $\mathcal{P}$，该轮廓通常由一组有
序的顶点 $V = \{v_1, v_2, \dots, v_k\}$ 定义的多边形边界
表示。我们的目标是生成一个模块集合 $\mathcal{M} = \{m_1, m_2, \dots, m_n\}$，其中
每一个 $m_i$ 代表一个矩形的模块化单元。

每个模块 $m_i$ 可以由其几何属性唯一确定，记为五元组：
\begin{equation}
    m_i = (x_i, y_i, w_i, h_i, \theta_i)
\end{equation}
其中，$(x_i, y_i)$ 表示模块的中心坐标，$w_i$ 和 $h_i$ 分别
表示模块的宽度和长度，$\theta_i \in \{0, 90^\circ\}$ 表示
模块的旋转角度（通常限制为正交旋转以适应标准化制造）。

\subsection{约束条件建模}

为了保证生成的布局方案在工程上的可行性，模块集合 $\mathcal{M}$ 必须
满足以下三类核心约束：

\subsubsection{几何覆盖约束 (Geometric Constraint)}
生成的模块必须严格位于给定的建筑边界内部，且不能超出轮廓范围。这一约
束确保了设计方案不违反用地的红线限制。形式化表示为：
\begin{equation}
    \forall m_i \in \mathcal{M}, \quad \text{Area}(m_i \cap \mathcal{P}) = \text{Area}(m_i)
    \label{eq:boundary_constraint}
\end{equation}
即模块 $m_i$ 与轮廓 $\mathcal{P}$ 的交集面积必须等于模块自身的面积。

\subsubsection{非重叠约束 (Non-overlapping Constraint)}
在物理空间中，任意两个模块之间不能发生体积上的冲突。即对于任意
两个不同的模块 $m_i$ 和 $m_j$，它们的空间交集必须为空：
\begin{equation}
    \forall i \neq j, \quad m_i \cap m_j = \emptyset
    \label{eq:overlap_constraint}
\end{equation}
这一约束保证了布局的物理合法性，避免了结构冲突。

\subsubsection{模数与尺寸约束 (Dimensional Constraint)}
模块化建筑的核心优势在于标准化。因此，模块的尺寸不能是任意
连续值，而必须属于一个预定义的标准化尺寸集合 $\mathcal{S}$。该集合
通常由运输限制（如道路限宽、集装箱尺寸）和生产线模数决定：
\begin{equation}
    (w_i, h_i) \in \mathcal{S} \quad \text{or} \quad (h_i, w_i) \in \mathcal{S}
    \label{eq:dimension_constraint}
\end{equation}
例如，$\mathcal{S}$ 可能包含 $\{3m \times 6m, 3m \times 9m, \dots\}$ 等标准规格
。违反此约束将导致定制成本激增，丧失模块化的经济性。

\subsection{优化目标函数}

在满足上述硬性约束的前提下，我们旨在寻找一个“最优”的布局方案。这种最优性由以
下三个相互竞争的目标共同定义：

\begin{enumerate}
    \item \textbf{最大化覆盖率 (Coverage Maximization)：} 为了提高土地利用率
	和得房率，模块集合 $\mathcal{M}$ 的总面积应尽可能接近建筑
	轮廓 $\mathcal{P}$ 的面积。
    \begin{equation}
        \max J_{\text{cov}} = \frac{\sum_{i=1}^{n} \text{Area}(m_i)}{\text{Area}(\mathcal{P})}
    \end{equation}
    
    \item \textbf{最小化模块数量 (Module Count Minimization)：} 在覆盖率相
	同的情况下，使用更少的大尺寸模块通常优于使用大量小尺寸模块，因为这能减少现
	场吊装次数和拼缝处理工作量，从而降低施工成本。
    \begin{equation}
        \min J_{\text{num}} = n = |\mathcal{M}|
    \end{equation}
    
    \item \textbf{最大化标准化程度 (Standardization Maximization)：} 为了发挥
	规模效应，应尽可能减少模块的类型数量（Types），即复用同一种规格的模块。
    \begin{equation}
        \min J_{\text{type}} = |\text{Unique}(\{(w_i, h_i) | m_i \in \mathcal{M}\})|
    \end{equation}
\end{enumerate}

综上所述，模块化平面布局生成问题被定义为一个多目标优化问题。由于建筑
轮廓的复杂性（非凸、不规则边界）以及离散的组合特性，该问题属于典
型的NP-难（NP-hard）问题，传统的精确求解算法难以在多项式时间内找
到全局最优解。这正是本章引入深度强化学习方法的根本动因。

\section{基于正交网格分解的初始化策略}
\label{sec:initialization}

为了将连续的建筑平面转化为计算机可处理的离散形式，并为后续的强化学习算法提供合法的状态空间，本研究提出了一种基于正交网格分解（Orthogonal Grid Decomposition, OGD）的初始化策略。该策略旨在将任意形状的建筑轮廓离散化为一系列基础的“原子单元”，作为模块化组装的最小颗粒度。

\subsection{轮廓离散化处理}

建筑平面轮廓 $\mathcal{P}$ 通常由一系列连续的二维坐标点定义。直接在连续空间中进行模块排布不仅计算复杂度极高，而且难以保证模块间的无缝拼接。因此，首先需要对设计空间进行离散化处理。

我们将建筑平面的包围盒（Bounding Box）划分为尺寸为 $\delta \times \delta$ 的正交网格系统。网格尺寸 $\delta$ 的设定至关重要，它通常取所有标准化模块尺寸的最大公约数（Greatest Common Divisor, GCD），以确保任何标准模块都可以由整数个网格单元组合而成。例如，若标准模块尺寸集合为 $\{3m \times 6m, 3m \times 9m\}$，则 $\delta$ 可设为 $3m$。

对于网格系统中的每一个单元 $g_{ij}$，我们根据其中心点 $c_{ij}$ 与建筑轮廓 $\mathcal{P}$ 的位置关系定义其状态 $S_{ij}$：
\begin{equation}
    S_{ij} = 
    \begin{cases} 
    1, & \text{if } c_{ij} \in \text{Interior}(\mathcal{P}) \\
    0, & \text{otherwise}
    \end{cases}
\end{equation}
其中，$S_{ij}=1$ 表示该网格为有效占据网格（Occupied Grid），$S_{ij}=0$ 表示无效网格。通过这一步骤，不规则的建筑轮廓被映射为一个二值化的占据矩阵（Occupancy Matrix）。

\subsection{初始原子网格生成}

在完成离散化后，所有标记为 $1$ 的有效网格构成了初始的“原
子网格集合”（Atomic Grid Set），记为 $\mathcal{A} = 
\{a_1, a_2, \dots, a_k\}$。每一个原子网格 $a_k$ 都被视为一
个独立的、最小尺寸的模块单元。

如图 \ref{fig:grid_decomposition} 所示，OGD 过程有效地解决
了非凸多边形（Non-convex Polygons）的填充难题。对于边界处的复
杂几何特征，算法采取“保守近似”策略，即仅保留中心点位于轮廓内
部的网格，从而保证生成的模块严格位于建筑红线范围内。

这一初始化过程为后续的深度强化学习任务构建了基础环境。此时，整个
平面布局被视为一个由 $k$ 个原子网格组成的初始状态，智能体的任务
即是通过一系列的决策动作，将这些细碎的原子网格逐步合并
为符合制造约束的大尺寸标准化模块。

% 请确认您 tex 文件中 Figure 2 的实际文件名，此处暂用 figs/grid_decomposition.pdf
\begin{figure}[htbp]
    \centering
    \includegraphics[width=1\textwidth]{Fig2/figure1.png}
    \caption{正交网格分解（OGD）过程示意图：(a) 原始建筑平面轮廓；(b) 网格离散化处理；(c) 生成的初始原子网格集合。该过程将连续的几何约束转化为离散的矩阵表示。}
    \label{fig:grid_decomposition}
\end{figure}

\subsection{模块尺寸归一化 (Modular Size Normalization)}
\label{subsec:msn}

正交网格分解（OGD）虽然能实现全覆盖，但可能产生超出制造限制的过大矩形。为了解
决这一问题，本研究在 OGD 之后引入了模块尺寸归一化（MSN）过程。

MSN 采用递归分割策略对尺寸超限的模块进行处理：
\begin{itemize}
    \item \textbf{宽度约束处理：} 对于宽度超过 $W_{max}$ 的矩形，执行水平分割
    ，将其划分为若干宽度均匀的子段。
    \item \textbf{高度约束处理：} 对于高度超过 $H_{max}$ 的矩形，执行垂直分割，
    将其划分为若干高度均匀的子段。
\end{itemize}

经过 MSN 处理后，输出的模块集合 $\mathcal{M} = \{m_1, m_2, \dots, m_k\}$ 既保证
了对原始轮廓的几何覆盖，又严格符合预设的制造与运输尺寸限制，为后续的强化学习优化
提供了合法的初始状态空间。

\section{空间邻接感知的深度强化学习算法}
\label{sec:drl_algorithm}

基于上一节生成的初始原子网格，我们将模块化平面布局生成问题建
模为一个马尔可夫决策过程（Markov Decision Process, MDP）。本
节详细阐述该MDP的关键要素，包括状态空间、动作空间以及奖励函数的
设计，重点介绍如何通过引入拓扑信息来增强智能体对空间结构的感知能力。

\subsection{状态空间设计}
\label{subsec:state_space}

为了在保证计算效率的同时捕捉关键布局特征，不同于计算昂贵的图像输入，我们将智能体的状态 $s_t$ 封装为一个紧凑的**七维特征向量**。该向量编码了当前的几何统计信息与拓扑属性：

\begin{equation}
state = [N_m, N_t, A_a, A_{max}, A_{min}, A_{adj}, C_s]
\end{equation}

各分量定义如下：
\begin{itemize}
    \item \textbf{全局计数特征：} $N_m$ 为当前模块总数，反映合并进度；$N_t$ 为不同模块类型的数量，直接对应标准化程度（越低越好）。
    \item \textbf{面积统计特征：} 包含平均面积 $A_a$、最大面积 $A_{max}$ 和最小面积 $A_{min}$。这些指标帮助智能体识别过小的碎片区域或潜在的合并机会。
    \item \textbf{拓扑与形状特征：} $A_{adj}$ 为归一化的相邻对计数，衡量当前布局的合并潜力；$C_s$ 为平均形状复杂度，用于惩罚不规则形状。
\end{itemize}

这种低维向量表示法确保了智能体能够快速推理，避免了处理高维图像数据带来的计算开销。

\subsection{动作空间与合并机制}
\label{subsec:action_space}

与传统的“自顶向下”切割方法不同，本研究采用“自底向上”的合并
策略。动作空间 $\mathcal{A}$ 定义为所有合法的“模块合并”操
作的集合。

在时间步 $t$，智能体选择一个动作 $a_t$，即选择两个相邻的
模块 $m_i$ 和 $m_j$ 进行合并。为了保证生成的模块始终为矩形
（符合制造标准），合并操作必须满足**矩形约束（Rectang
ularity Constraint）**：即 $m_i$ 和 $m_j$ 合并后的形状必
须仍为一个矩形。

如图 \ref{fig:action_merge} 所示，若两个模块共享一条公
共边且合并后不形成凹多边形，则该合并动作是合法的。通过不断执
行合并动作，原本细碎的原子网格逐渐聚合成大尺寸的标准化模块，
直到没有合法的合并动作或达到终止条件为止。

% 请将此处的文件名 'figs/action_merge.png' 替换为您 tex 文件中 Figure 4 的实际文件名
\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.8\textwidth]{Fig2/figure3.png}
    \caption{基于合并策略的动作空间示意图。智能体选择相邻的两个单元进行合并，前提是合并后的新单元必须保持矩形特征，以满足模块化制造的几何约束。}
    \label{fig:action_merge}
\end{figure}

\subsection{奖励函数设计}
\label{subsec:reward_function}

为了引导智能体在满足 DfMA（面向制造与装配的设计）原则的同时优化空间布局，我们设计了一个包含六个竞争目标的多目标奖励函数。该函数通过线性加权的方式平衡各优化目标：

\begin{equation}
\begin{split}
R = & \ w_{count} \cdot R_{count} + w_{type} \cdot R_{type} + w_{util} \cdot R_{util} \\
    & + w_{complexity} \cdot R_{complexity} + w_{compactness} \cdot R_{compactness} \\
    & + R_{validity} + R_{multi}
\end{split}
\label{eq:reward_function}
\end{equation}

其中各项的具体含义与权重配置如表 \ref{tab:hyperparameters} 所示。我们特别为 $R_{type}$ 分配了较高的权重（16.0），以显式地鼓励智能体优先考虑模块类型的标准化。此外，设置了严厉的无效惩罚 $R_{validity}$ (-50.0) 以确保几何可行性。

\begin{table}[htbp]
\centering
\caption{超参数设置与奖励函数权重配置}
\label{tab:hyperparameters}
\begin{tabular}{ll|ll}
\toprule
\multicolumn{2}{c|}{\textbf{训练超参数}} & \multicolumn{2}{c}{\textbf{奖励权重 (Eq. \ref{eq:reward_function})}} \\
\midrule
\textbf{参数} & \textbf{数值} & \textbf{符号} & \textbf{数值} \\
\midrule
批次大小 (Batch Size) & 32 & $w_{count}$ (数量减少) & 8.0 \\
经验池容量 (Replay Memory) & 10,000 & $w_{type}$ (类型标准化) & 16.0 \\
折扣因子 ($\gamma$) & 0.99 & $w_{util}$ (尺寸利用率) & 5.0 \\
学习率 ($\alpha$) & 0.001 & $w_{complexity}$ (形状简单度) & 2.0 \\
最大回合数 (Max Episodes) & 100 & $w_{compactness}$ (空间紧凑度) & 3.0 \\
无效惩罚 ($R_{validity}$) & -50.0 & 多重合并奖励 ($R_{multi}$) & 10.0 \\
\bottomrule
\end{tabular}
\end{table}


\subsection{网络架构与训练策略}
\label{subsec:network_training}

为了构建状态 $s_t$ 到动作 $a_t$ 的映射关系，本研究采用了深
度Q网络（Deep Q-Network, DQN）算法。DQN 结合了深度学习的
感知能力与强化学习的决策能力，能够有效处理高维状态空间下的
策略学习问题。

\subsection{神经网络架构}
\label{subsec:network_arch}

鉴于状态空间已被精简为特征向量，本研究采用了高效的前馈神经网络（Feedforward Neural Network, FNN）作为 DQN 的函数近似器，而非复杂的卷积网络。

如图 \ref{fig:dqn_architecture} 所示，网络架构具体配置如下：
\begin{itemize}
    \item \textbf{输入层：} 包含 7 个神经元，直接对应七维状态向量。
    \item \textbf{隐藏层：} 设计了两个全连接隐藏层。第一层包含 64 个神经元，第二层包含 32 个神经元。所有隐藏层均采用 ReLU \citep{nair2010rectified} 作为激活函数，以引入非线性映射能力。
    \item \textbf{输出层：} 输出节点的数量对应于当前状态下所有合法合并动作的数量。每个节点输出对应动作的 Q 值（即预期的长期累积奖励）。
\end{itemize}

该轻量级架构使得智能体能够在毫秒级内完成推理，满足了布局优化对实时性的要求。

\subsubsection{训练策略}
为了提高训练的稳定性和收敛速度，本研究采用了以下策略：
\begin{itemize}
    \item \textbf{$\epsilon$-贪婪策略（$\epsilon$-gr
    eedy Policy）：} 在动作选择阶段，以概率 $\epsilon$ 随机
    选择动作以保持探索性（Exploration），以概率 $1-\epsilon$ 选
    择当前Q值最大的动作以利用已知经验（Exploitation）。随着训
    练的进行，$\epsilon$ 值逐渐减小，使智能体从探索逐渐转向利用。
    \item \textbf{经验回放（Experience Replay）：} 构建经验
    池存储智能体的交互样本 $(s_t, a_t, r_t, s_{t+1})$。训练时
    从中随机采样小批量数据（Mini-batch）进行梯度下降更新。这
    一机制打破了样本间的时序相关性，显著提升了数据利用率和训练
    稳定性。
    \item \textbf{目标网络（Target Network）：} 引入一个独立
    的、参数更新滞后的目标网络 $\hat{Q}$ 来计算目标Q值。这减少
    了目标值与预测值之间的相关性，有效抑制了训练过程中的震荡。
\end{itemize}

% 请将此处的文件名替换为您 tex 文件中 Figure 5 对应的实际文件名
\begin{figure}[htbp]
    \centering
    \includegraphics[width=1\textwidth]{Fig2/figure6.png}
    \caption{深度Q网络（DQN）架构示意图。网络接收网格状态输入，通过深度神经网络拟合动作价值函数，输出各潜在合并动作的Q值。}
    \label{fig:network_arch}
\end{figure}


\section{实验结果与分析}
\label{sec:experiments}

为了验证所提出的空间邻接感知模块化方法的有效性，我们进行了一系列广泛的实验。本节首先介绍数据集的构建过程和实验设置，随后定义用于量化评估布局质量的评价指标，最后展示定量对比结果与定性可视化分析。

\subsection{实验设置与数据集}
\label{subsec:dataset}

为了系统地验证所提出强化学习框架的有效性与鲁棒性，本研究建立了一个
包含不同几何复杂度的综合数据集（Dataset）。依据英文原文描述，该数据集
具体由以下两组场景构成：

\begin{enumerate}
    \item \textbf{标准模块化场景 (Standard Modular Scenarios)：} 包含源自真
    实住宅项目的典型建筑平面（案例 JF, LM, ZH），主要用于验证算法在常规布局标
    准化方面的能力。
    \item \textbf{大规模复杂场景 (Large-Scale Complex Scenarios)：} 包含具有
    大尺度边界和高维搜索空间的复杂平面（案例 GF, XZ, HY），旨在测试算法在
    处理复杂空间约束时的可扩展性与稳定性。
\end{enumerate}

所有实验均在配置 Intel Core i5-13400F CPU 和 NVIDIA RTX 4070 GPU 的工作站上进行。
算法基于 Python 和 PyTorch 库实现。DQN 智能体的超参数（如 $\epsilon$-greedy 策
略的衰减因子 0.95）均经过经验微调以平衡探索与利用。

\subsection{评价指标}
\label{subsec:metrics}

为了全面评估生成布局的质量，本研究定义了三个核心评价指标，分别对应覆盖率、标准化程度和计算效率。

\subsubsection{覆盖率 (Coverage Rate, CR)}
覆盖率衡量了生成的模块化布局对原始建筑轮廓的填充程度，是评估空间利用率的关键指标。其计算公式为：
\begin{equation}
    \text{CR} = \frac{\sum_{m \in \mathcal{M}} \text{Area}(m)}{\text{Area}(\mathcal{P})} \times 100\%
\end{equation}
其中，$\mathcal{M}$ 是生成的模块集合，$\mathcal{P}$ 是原始建筑轮廓。$\text{CR}$ 值越高，表示死角空间越少，得房率越高。

\subsubsection{模块标准化率 (Standardization Ratio, SR)}
标准化率用于评估布局中模块规格的统一程度，直接关联制造成本。我们将其定义为主要模块类型（出现频率最高的 Top-K 种模块）所占面积的比例：
\begin{equation}
    \text{SR} = \frac{\sum_{m \in \mathcal{M}_{\text{std}}} \text{Area}(m)}{\sum_{m \in \mathcal{M}} \text{Area}(m)} \times 100\%
\end{equation}
其中，$\mathcal{M}_{\text{std}}$ 表示属于标准尺寸集合的模块子集。$\text{SR}$ 值越高，意味着生产线的模具复用率越高，经济性越好。

\subsubsection{邻接一致性 (Adjacency Consistency, AC)}
为了量化算法对空间拓扑关系的保持能力，我们提出了邻接一致性指标。该指标计算生成布局的邻接图与原始空间邻接图之间的相似度：
\begin{equation}
    \text{AC} = \frac{|E_{\text{gen}} \cap E_{\text{orig}}|}{|E_{\text{orig}}|}
\end{equation}
其中，$E_{\text{gen}}$ 和 $E_{\text{orig}}$ 分别表示生成布局和原始空间划分中的邻接边集合。$\text{AC}$ 值越高，说明房间之间的功能联系被保留得越完整。



\section{实验结果与分析}
\label{sec:experiments}

本节将详细阐述所提出的空间邻接感知模块化生成框架的实验评估。首先介绍用于训练和测试的数据集生成过程及参数设置，随后定义用于量化布局质量的评价指标，最后展示模型在不同复杂度建筑轮廓下的生成结果。

\subsection{数据集生成与实验设置}
\label{subsec:dataset_setup}

由于缺乏公开的模块化建筑平面布局数据集，本研究构建了一个包含多样化建筑轮廓的合成数据集。为了模拟现实世界中复杂多变的用地条件，我们采用随机生成算法创建了训练样本。

\subsubsection{数据生成}
数据集包含不同几何特征的建筑轮廓，涵盖了从简单的凸多边形（如矩形、L形）到复杂的凹多边形。每个轮廓被离散化为正交网格，作为智能体的初始环境。我们共生成了 \textbf{[请填入具体数量]} 个样本，并按照 \textbf{[请填入比例]} 的比例将其划分为训练集和测试集。

\subsubsection{参数设置}
实验基于深度强化学习框架进行。在DQN训练过程中，超参数设置如下：经验回放池（Replay Buffer）大小设定为 \textbf{[数值]}，折扣因子 $\gamma$ 设为 \textbf{[数值]}，学习率设为 \textbf{[数值]}。为了平衡探索与利用，采用 $\epsilon$-贪婪策略，$\epsilon$ 值随训练步数从 \textbf{[初始值]} 线性衰减至 \textbf{[最终值]}。

% 请替换为您 tex 文件中对应“数据集”或“训练曲线”的图片文件名
\begin{figure}[H]
\centering
\includegraphics[width=1\textwidth]{Fig2/figure8.png} 
\caption{数据集样本示例及训练过程中的奖励收敛曲线。}
\label{fig:dataset_training}
\end{figure}

\subsection{评价指标}
\label{subsec:metrics}

为了全面评估生成布局的质量，本研究主要关注以下三个核心指标，这也与奖励函数的设计保持一致：

\begin{enumerate}
    \item \textbf{覆盖率 (Coverage Rate, CR)}：衡量生成的模块化布局对原始建筑轮廓的填充程度。高覆盖率意味着更高的空间利用率和得房率。
    \item \textbf{模块标准化率 (Standardization Ratio, SR)}：定义为标准尺寸模块面积占总建筑面积的比例。该指标直接反映了布局的可制造性与经济性。
    \item \textbf{邻接完整性 (Adjacency Integrity)}：评估生成的布局是否保持了原始空间的连通性，即是否避免了将单一功能空间不合理地分割为互不连通的孤岛。
\end{enumerate}

\subsection{结果分析}
\label{subsec:results}

\subsubsection{标准模块化场景性能评估}
表 \ref{tab:std_performance} 展示了在三个标准案例（JF, LM, ZH）中，本方法与人工划分基准的详细对比。
实验结果表明，智能体成功习得了符合 DfMA 原则的策略。特别是在案例 ZH 中，为了最大化标准化程度，智能体将模块类型数量 ($C_t$) 从人工方案的 19 种显著降低至 15 种（降幅 21.05\%），同时仅略微增加了 1 个模块数量。这证明了算法能够在保证覆盖率的前提下，有效权衡制造成本（模具数量）与吊装成本（模块数量）。

% \begin{table}[htbp]
%     \centering
%     \caption{标准模块化场景下的性能对比（人工划分 vs 本文方法）}
%     \label{tab:std_performance}
%     \begin{tabular}{lcccl}
%         \toprule
%         \textbf{案例} & \textbf{指标} & \textbf{人工划分} & \textbf{本文方法 (RL)} & \textbf{变化幅度} \\
%         \midrule
%         \multirow{2}{*}{Case JF} & $C_m$ (数量) & 10 & \textbf{11} & $\uparrow$ 10\% \\
%                                  & $C_t$ (类型) & 8 & \textbf{7} & $\downarrow$ 12.5\% (优化) \\
%         \midrule
%         \multirow{2}{*}{Case LM} & $C_m$ (数量) & 7 & \textbf{7} & 持平 \\
%                                  & $C_t$ (类型) & 6 & \textbf{5} & $\downarrow$ 16.67\% (优化) \\
%         \midrule
%         \multirow{2}{*}{Case ZH} & $C_m$ (数量) & 19 & \textbf{20} & $\uparrow$ 5.26\% \\
%                                  & $C_t$ (类型) & 19 & \textbf{15} & $\downarrow$ 21.05\% (显著优化) \\
%         \bottomrule
%     \end{tabular}
% \end{table}

\begin{table}[htbp]
    \centering
    \caption{Comparative performance analysis between Manual Partitioning and the Proposed RL Framework across standard modular scenarios.}
    \label{tab:performance_comparison}
    
    \begin{tabular}{ c m{0.32\linewidth}<{\centering} m{0.32\linewidth}<{\centering} m{0.22\linewidth} }
        \toprule
        Case & Manual Partitioning & Ours (RL) & Metrics Comparison \\
        \midrule
        \addlinespace[5pt] 
        
        % --- Case 1: JF ---
        JF 
        & 
        \raisebox{-0.5\height}{\includegraphics[width=0.95\linewidth, height=2.5cm, keepaspectratio]{Fig2/figure7_1.png}}%
        & 
        \raisebox{-0.5\height}{\includegraphics[width=0.95\linewidth, height=2.5cm, keepaspectratio]{Fig2/figure7_2.png}}%
        & 
        \begin{tabular}{@{}l@{}}
            $C_m$: $10 \to \mathbf{11}$ \\ 
            \small{\textcolor{gray}{($\uparrow$ 10\%)}} \\[0.5em]
            $C_t$: $8 \to \mathbf{7}$ \\
            \small{\textcolor{gray}{($\downarrow$ 12.5\%)}} \\[0.5em]
        \end{tabular}
        \\
        \addlinespace[5pt] 
        \cmidrule(l){2-4}
        \addlinespace[5pt] 
        
        % --- Case 2: LM ---
        LM  
        & 
        \raisebox{-0.5\height}{\includegraphics[width=0.95\linewidth, height=2.5cm, keepaspectratio]{Fig2/figure7_3.png}}%
        & 
        \raisebox{-0.5\height}{\includegraphics[width=0.95\linewidth, height=2.5cm, keepaspectratio]{Fig2/figure7_4.png}}%
        & 
        \begin{tabular}{@{}l@{}}
            $C_m$: $7 \to \mathbf{7}$ \\ 
            \small{\textcolor[gray]{0.5}{(Equal)}} \\[0.5em]
            
            $C_t$: $6 \to \mathbf{5}$ \\
            \small{\textcolor[gray]{0.5}{($\downarrow$ 16.67\%)}}
        \end{tabular}
        \\
        \addlinespace[5pt]
        \cmidrule(l){2-4}
        \addlinespace[5pt]
        
        % --- Case 3: ZH ---
        ZH  
        & 
        \raisebox{-0.5\height}{\includegraphics[width=0.95\linewidth, height=2.5cm, keepaspectratio]{Fig2/figure7_5.png}}%
        & 
        \raisebox{-0.5\height}{\includegraphics[width=0.95\linewidth, height=2.5cm, keepaspectratio]{Fig2/figure7_6.png}}%
        & 
        \begin{tabular}{@{}l@{}}
            $C_m$: $19 \to \mathbf{20}$ \\ 
            \small{\textcolor{gray}{($\uparrow$ 5.26\%)}} \\[0.5em]
            $C_t$: $19 \to \mathbf{15}$ \\
            \small{\textcolor{gray}{($\downarrow$ 21.05\%)}} \\[0.5em] 
        \end{tabular}
        \\
        \addlinespace[5pt]
        
        \bottomrule
    \end{tabular}
\end{table}

\subsubsection{大规模复杂场景的可扩展性}
对于具有高度非凸边界的大规模场景，表 \ref{tab:large_scale_results} 统计了生成布局的模块指标。以最复杂的 Case XZ 为例，在初始包含超过 200 个原子网格的巨大搜索空间中，算法成功将最终模块数量控制在 151 个，并保持模块类型仅为 19 种。在 Case HY 中，算法实现了极高的模块复用率，仅用 6 种模块类型即覆盖了 68 个模块区域（平均每种模具复用约 11.3 次）。

\begin{table}[htbp]
\centering
\caption{大规模复杂场景下的优化结果统计}
\label{tab:large_scale_results}
\begin{tabular}{lccc}
\toprule
\textbf{评价指标} & \textbf{案例 GF} & \textbf{案例 XZ} & \textbf{案例 HY} \\
\midrule
模块总数 ($C_m$) & 46 & 151 & 68 \\
模块类型数 ($C_t$) & 19 & 19 & 6 \\
\bottomrule
\end{tabular}
\end{table}

\section{讨论}
\label{sec:discussion}

实验结果证明了所提出的框架在解决模块化布局优化这一组合难题上的有效性。除了数值上的提升，本节将进一步分析智能体的决策逻辑，特别是奖励权重的调整如何影响面向制造与装配的设计（DfMA）中的关键权衡。

\subsection{DfMA权衡的解读与偏好学习}
\label{subsec:dfma_tradeoff}

通过对比分析标准案例的优化结果，我们发现智能体对奖励函数中的多目标配置表现出高度的敏感性。
在案例 JF 中，智能体生成了一个模块数量略有增加（$C_m: 10 \to 11$）但模块类型显著减少（$C_t: 8 \to 7$）的方案。这一结果并非偶然，而是奖励重塑策略的直接体现。

通过为 $R_{type}$（模块类型标准化）分配较大的权重，我们显式地激励智能体优先考虑“标准化”而非单纯的“数量最小化”。与通常依赖几何直觉来最小化切割线（从而减少 $C_m$）的人工划分不同，强化学习智能体成功习得了一种非直观的全局策略：它牺牲了局部的合并效率，以换取整体模块复用率（Module Reuse Rate）的最大化。

在预制建筑的语境下，这种策略在经济上是更优的。因为与模具制造和生产线重组相关的“多样性成本”（Cost of Variety），往往远高于运输少数几个额外标准化单元的边际物流成本。案例 JF 的行为证实，本框架不仅仅是在进行几何填充，而是能够智能地将策略与奖励函数中编码的高层级 DfMA 偏好保持一致。

\subsection{可扩展性与搜索空间管理}
\label{subsec:scalability}

在大规模复杂场景（如案例 XZ）上的可扩展性分析凸显了\textit{空间邻接感知}机制相对于传统启发式方法的优越性。
在案例 XZ 中，初始网格分解产生了超过 200 个原子块，导致有效合并对的组合搜索空间呈阶乘级增长。传统的进化算法（如遗传算法）在如此高维的空间中，由于变异算子的随机性，往往面临过早收敛或生成大量无效几何形状的问题。

相比之下，我们的 DQN 智能体利用空间邻接掩码（Spatial Adjacency Mask），有效地修剪了无效的动作空间（通过 $R_{validity}$ 惩罚），迫使探索过程仅关注几何上可行的区域。收敛轨迹表明，智能体迅速学会了拒绝随机合并，并采用了一种结构化的策略，优先形成大型、规则的矩形，即使在高度非凸的边界条件下也能实现较高的模块复用率。

\subsection{局限性与未来工作}
\label{subsec:limitations}

虽然本框架为智能模块化设计建立了稳固的基准，但仍有几个局限性值得进一步研究：
\begin{enumerate}
    \item \textbf{几何离散化约束：} 当前方法依赖于正交网格分解（OGD），这限制了其仅适用于直角多边形轮廓。处理曲线或非正交的建筑边界将需要在未来的迭代中引入基于网格（Mesh）或连续状态的表示方法。
    \item \textbf{结构物理集成：} 目前的可行性检查主要基于几何规则。未来的工作应将简化的有限元分析（FEA）集成到奖励反馈循环中，以便在合并过程中显式地优化承载能力和质心对齐。
    \item \textbf{交互式人机协作：} 尽管加权奖励函数允许进行偏好调整，但在实际应用中需要一个更具交互性的界面，允许建筑师在推理阶段动态施加“硬约束”（例如固定的核心筒位置）。
\end{enumerate}

\section{本章小结}
\label{sec:chapter_summary}

本章提出了一种针对模块化建筑平面布局设计的智能优化框架，创新性地将正交网格分解（OGD）与空间邻接感知的深度Q网络（Deep Q-Network）相结合。通过将模块划分与合并过程公式化为一个序列决策问题，我们解决了在高维设计空间中平衡空间利用率、几何规则性和制造标准化这一难题。

综合实验验证得出了以下关键结论：
\begin{enumerate}
    \item \textbf{优化有效性：} 该框架在性能上始终匹配或优于专家级的人工划分。在复杂场景（如案例 ZH）中，它通过将模块类型减少约 21\% 同时保持模块数量稳定，实现了显著的优化，成功突破了限制人类设计师的局部最优解。
    \item \textbf{标准化能力：} 通过多目标奖励机制，智能体展现了强大的面向 DfMA 的优化能力。它能够自主发现最大化模块复用率的布局策略，这对模块化建筑的经济可行性至关重要。
    \item \textbf{复杂拓扑下的鲁棒性：} 空间邻接感知策略确保了即使在具有高度不规则边界的大规模布局（如案例 XZ）中，也能实现 100\% 的几何有效性，克服了传统随机优化方法中常见的无效解问题。
\end{enumerate}

综上所述，本研究表明，当深度强化学习被赋予领域特定的空间感知能力时，能够为计算机辅助建筑设计提供一种强大且可扩展的新范式。未来的研究将集中于将此框架扩展到三维体积组装，并集成多物理场模拟，以进一步弥合概念设计与工程实现之间的鸿沟。




